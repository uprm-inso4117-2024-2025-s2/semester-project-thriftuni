rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Reglas para usuarios
    match /users/{userId} {
      allow read: if request.auth != null; // Cualquier usuario autenticado puede leer perfiles
      allow write: if request.auth != null && request.auth.uid == userId; // Solo el dueño puede modificar su perfil
    }

    // Reglas para categorías (son públicas, solo lectura)
    match /categories/{categoryId} {
      allow read: if true; // Todos pueden leer categorías
      allow write: if false; // Nadie puede escribir en esta colección manualmente
    }

    // Reglas para listings (objetos en venta)
    match /listing/{listingId} {
      allow read: if true; // Todos pueden ver listings
      allow write: if request.auth != null && request.auth.uid == resource.data.ownerId; 
      // Solo el dueño del listing puede modificarlo
    }

    // Reglas para relacionar categorías y listings
    match /listing_categories/{relationId} {
      allow read: if true; // Todos pueden ver las relaciones entre listings y categorías
      allow write: if false; // Bloqueamos escritura manual (solo debería hacerse desde backend)
    }

    // Bloquear acceso a cualquier otra colección desconocida
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
